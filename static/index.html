<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Discord-Themed UI</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
            body {
                background-color: #36393f;
                color: #ffffff;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            .navbar {
                background-color: #2f3136;
            }
            .navbar-brand, .navbar-nav .nav-link {
                color: #ffffff;
            }
            .btn-custom {
                background-color: #7289da;
                color: #ffffff;
            }
            .btn-custom:hover {
                background-color: #677bc4;
            }
            .action-box {
                background-color: #40444b;
                color: #ffffff;
                cursor: pointer;
                padding: 10px;
                border-radius: 5px;
                margin-right: 10px;
            }
            .action-box.active {
                background-color: #7289da;
            }
            .output-box {
                background-color: #2f3136;
                color: #ffffff;
                border: 1px solid #40444b;
            }
        </style>
    </head>
    <body>

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Discord-Themed UI</a>
                <div class="collapse navbar-collapse justify-content-end">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <button class="nav-link" onclick="login()">Login</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Container -->
        <div class="container mt-4">
            <!-- Email Body Input -->
            <div class="mb-3">
                <label for="emailBody" class="form-label">Email Body</label>
                <textarea class="form-control output-box" id="emailBody" rows="6" placeholder="Type your email content here..." oninput="updateCharCount()"></textarea>
                <div class="text-end mt-1">
                    <small id="charCount">0 characters</small>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mb-3">
                <div id="actionButtons" class="d-flex">
                    <div class="action-box" onclick="toggleAction(this)">Summarize</div>
                    <div class="action-box" onclick="toggleAction(this)">Formal</div>
                    <div class="action-box" onclick="toggleAction(this)">Aggressive</div>
                    <div class="action-box" onclick="toggleAction(this)">Sad</div>
                    <div class="action-box" onclick="toggleAction(this)">Key account manager from Omantel, Muscat</div>
                </div>
            </div>

            <!-- Custom Action Input -->
            <div class="mb-3 d-flex">
                <input type="text" class="form-control output-box" id="customAction" placeholder="Type your custom action here...">
                <button class="btn btn-custom ms-2" onclick="addCustomAction()">Add</button>
            </div>

            <!-- Process Button -->
            <button class="btn btn-custom" onclick="processRequest()">Process</button>

            <!-- Output Text Box -->
            <div class="mt-3">
                <label for="outputText" class="form-label">Output</label>
                <textarea class="form-control output-box" id="outputText" rows="6" placeholder="Output will appear here..." readonly></textarea>
            </div>
        </div>

        <script>
            let hostName = "localhost"
            let port = 8080
            let serverUrl = `http://${hostName}:${port}`

            function login() {
                window.location.href = `${serverUrl}/login`;
            }
            
            function updateCharCount() {
                const charCount = document.getElementById('emailBody').value.length;
                document.getElementById('charCount').innerText = `${charCount} characters`;
            }

            function toggleAction(element) {
                const actionBoxes = document.querySelectorAll('.action-box');
                actionBoxes.forEach(box => box.classList.remove('active'));
                element.classList.add('active');
            }

            function processRequest() {
                const emailBody = document.getElementById('emailBody').value;
                const selectedAction = document.querySelector('.action-box.active')?.innerText || '';
                const customAction = document.getElementById('customAction').value;
                const prompt = `${customAction ? customAction + ' ' : ''}${selectedAction ? selectedAction + ' ' : ''}${emailBody}`;

                const payload = {
                    email_body: emailBody,
                    action: selectedAction,
                    custom_action: customAction
                };

                fetch(`${serverUrl}/get_processed_text`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('outputText').value = data["response_msg"];
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('outputText').value = 'Error: Unable to process request';
                });
            }

            function addCustomAction() {
                const customActionValue = document.getElementById('customAction').value;
                if (customActionValue.trim()) {
                    const actionButtonsContainer = document.getElementById('actionButtons');
                    const newActionBox = document.createElement('div');
                    newActionBox.classList.add('action-box');
                    newActionBox.innerText = customActionValue;
                    newActionBox.onclick = function() { toggleAction(newActionBox); };
                    actionButtonsContainer.appendChild(newActionBox);
                    document.getElementById('customAction').value = ''; // Clear input
                }
            }
        </script>
    </body>
</html>
